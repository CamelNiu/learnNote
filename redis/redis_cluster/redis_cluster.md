## redis集群(cluster)

#####1,简介

	    本文主要总结redis自带的集群方案，cluster。做到了灵活的扩容缩容方案，在不影响集群服务的情
	况下，可以直接进行扩容缩容。

	    另外，redis做集群服务有相当多的方案，开发人员可以根据不同的场景自己实现集群逻辑。本文不进
	行讨论，具体实现思路百度有很多。
		
	    cluster的大概原理，就是每个集群中的redis节点，分别维护自己的数据槽，数据槽存储着属于本槽的数据。
	在节点扩容缩容的时候,相应的将数据槽迁入迁出即可。存储数据的key，通过特定的算法,平均的分到16384个
	槽中。执行查询的时候可以自动的根据key，检索到对应的节点和槽，获取数据。并且redis的cluster集群方案自带
	哨兵机制。
	
#####2,redis实现集群

1，自动搭建集群

	redis5之后的版本，可用如下命令搭建集群

	redis-cli --cluster create \		#搭建集群命令
		8.8.8.11:6379 \					#集群节点……
		8.8.8.12:6379 \
		8.8.8.13:6379 \
		8.8.8.14:6379 \
		8.8.8.15:6379 \
		8.8.8.16:6379 \
		--cluster-replicas=1 \			#创建集群主从节点，1代表一个主只配置一个从

	注意：
		1，执行上述命令，机器会激动分配好，同意输入yes回车即可，不同意需要手动创建
		2，redis集群最低要求是三台主节点。如果做主从最少六台节点，否则会报错。
		3，命令执行完毕，主从节点，数据槽都分配完毕，也可以说主从搭建完毕，很简单。

2，手动搭建集群
	
	    假如每台redis节点的配置不同，主从节点需要指定，槽分配需要指定的话，自动分配肯定是达不到要求的
	可以进行手动方式搭建集群。

	搭建集群：

		1，准备节点	

				8.8.8.11:6379
				8.8.8.12:6379 
				8.8.8.13:6379 
				8.8.8.14:6379 
				8.8.8.15:6379 
				8.8.8.16:6379 

		2，节点握手(用的gossip)
			命令：
				cluster meet ip port
			
			假设当前是11的客户端，则：
				cluster meet 8.8.8.12 6379
				cluster meet 8.8.8.13 6379
				cluster meet 8.8.8.14 6379
				cluster meet 8.8.8.15 6379
				cluster meet 8.8.8.16 6379
			
				执行完上面命令，则所有节点握手成功，目前是六个主节点的redis集群。

				查看主从结构：
					cluster nodes;

			集群分配主从：
				cluster replicate {nodeId}	
				命令执行必须在对应的从节点上执行，将当前节点设置为 ``node_id`` 指定的节点的从节点
				例如：
				  在8.8.8.13客户端执行，则8.8.8.13客户端为从节点，其主节点id为nodeId。


		3,分配数据槽(0-16383)
				命令：
					redis-cli -h <ip> cluster addslots {0..5461} 
					redis-cli -h <ip> cluster addslots {5462..10922} 
					redis-cli -h <ip> cluster addslots {10923..16383} 


				

		注意：
			现在一般都是自动化部署，没有特殊需求，建议自动化部署。